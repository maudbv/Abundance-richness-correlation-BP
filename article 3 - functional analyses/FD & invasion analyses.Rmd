---
title: "Functional diversity and invasions"
author: "Maud Bernard-Verdier"
date: "14 ao√ªt 2015"
output: html_document
---

This document runs the analyses and plots/outputs exploratory statistics.

```{r setup, include =FALSE}
require(knitr)

if( length(grep('mac', .Platform$pkgType) ) == 0){
knitr::opts_knit$set( root.dir = "C:/Users/bernarm2/Dropbox/Work/doc boulot/post doc Lincoln/R_alienimpactBP")
}

 if( length(grep('mac', .Platform$pkgType) ) == 1) {
knitr::opts_knit$set( root.dir = "~/Dropbox/Work/doc boulot/post doc Lincoln/R_alienimpactBP")
 }

knitr::opts_chunk$set( echo = FALSE, warning=FALSE)

# load packages
library(doBy)
library(vegan)
library(markdown)
```

We first import vegetation and environmental data for Banks Peninsula:
``` {r import.species}
 source('script/data/import BP species and environment data.R', encoding = "UTF-8")
```

We then import trait data from different databases
``` {r import.traitdata}
 source('script/data/import trait data.R', encoding = "UTF-8")

```

We then import my trait data
``` {r import.my traits}
 source('script/data/my trait data.R', encoding = "UTF-8")
```


``` {r check.leaf_traits}
## check LA values
boxplot(leaf.area ~spcode, mySLA, las =2, ylab="leaf area")  ## no real outliers in leaf area
plot(leaf.area ~ as.numeric(as.factor(spcode)), mySLA, las =2, type = "p", log ="y")  # perhaps 


## check DM values
boxplot(leaf.dry.mass ~spcode, mySLA, las =2, ylab="leaf dry mass")  ## no real outliers in leaf area
plot(leaf.dry.mass ~ as.numeric(as.factor(spcode)), mySLA,  las =2, type = "p", log ="y")  

## check SLA values
boxplot(sla ~spcode, mySLA, las =2, ylab="SLA") # 2 outliers
# outlier.sp <- unique(mySLA[which(mySLA$sla >250),"spcode"])

# outlier.sp2 <- identify( as.numeric( as.factor(mySLA$spcode)),mySLA$sla )
# outlier.sp2 <-unique(mySLA[outlier.sp2,"spcode"])

# outlier.sp <- unique(c(outlier.sp, outlier.sp2))

# write.csv(mySLA[mySLA$spcode %in% outlier.sp,], file ="outliersSLA.csv")
```
 
 Checking that my trait measurements are comparable to database trait data :
```{r mytraitcheck}
plot(logHmax~ logSM,data= mytraits, bg = "black", pch = 21)
abline(lm(logHmax~ logSM,data= mytraits),  bg = "black", pch = 21)
points(log(traitdata$H_LEDA)~ log(traitdata$SM_LEDA))
abline(lm(log(traitdata$H_LEDA)~ log(traitdata$SM_LEDA)), lty = "dotted")
legend("bottomright", legend = c("my measurements", "mean database values"), pch=c(21, 21), pt.bg = c("black", "white"))


plot(logHmax~ SLA,data= mytraits, bg = "black", pch = 21)
abline(lm(logHmax~ SLA,data= mytraits),  bg = "black", pch = 21)
points(log(traitdata$H_LEDA)~ traitdata$SLA_LEDA)
abline(lm(log(traitdata$H_LEDA)~ traitdata$SLA_LEDA), lty = "dotted")
legend("bottomright", legend = c("my measurements", "mean database values"), pch=c(21, 21), pt.bg = c("black", "white"))

plot(Hmax~ SLA,data= mytraits, bg = "black", pch = 21)
abline(lm(Hmax~ SLA,data= mytraits),  bg = "black", pch = 21)
points(traitdata$Hmax_ordo~ traitdata$SLA_ordo)
abline(lm(log(traitdata$H_LEDA)~ traitdata$SLA_LEDA), lty = "dotted")
legend("bottomright", legend = c("my measurements", "mean database values"), pch=c(21, 21), pt.bg = c("black", "white"))


```

#taxonomy solving :
```{r}
# extract names, match them to DB, create a reference list of changes, update initial DB

```


# load functions

```{r source functions}
 source('script/functions/p2star.R')
```

 We save the results in a .Rdata object
```{r echo=T}
 # save.image("saved Rdata/article 3 - trait and phylo/FD and invasion.Rdata")

```

